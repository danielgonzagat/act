# V62 — Chat Trace Mining + Goal Shadow Schema (TRY2 canônico)

## Objetivo
- Tornar `goal_shadow.jsonl` “spec-literal”: 1 linha por goal por turno (`ctx_sig`, `goal_id`, `skipped_by_scheduler`), com stub determinístico quando pulado.
- Gerar dataset minerável (`goal_shadow_trace.jsonl`) a partir do **chat** (traces reais) sem alterar tokens.
- Fechar loop WORM: chat shadow trace → mine (INS) → promote multi (budget) → PCC v2 → from-store verify → invariância do chat.

## Artefatos WORM (TRY2 canônico)
- Smoke: `results/run_smoke_v62_try2/`
- Pipeline: `results/run_chat_trace_mine_end2end_v62_try2/`
- Diff: `patches/v62_chat_trace_mining_goalshadow_schema_try2.diff`
- Freeze: `LEDGER_ATOLANG_V0_2_22_BASELINE_V62_CHAT_TRACE_MINING_GOALSHADOW_SCHEMA_TRY2.json`

## Como reproduzir (WORM)
### 1) Compile
`cd act && python3 -m py_compile atos_core/*.py scripts/*.py`

### 2) Smoke v62 (novo out dir)
`cd act && python3 scripts/smoke_chat_trace_miner_v62.py --acts_run results/run_pure_20k_v39_contracts_paraphrase_telemetry_smoke --out results/run_smoke_v62_tryN`

### 3) Pipeline v62 (novo out dir + freeze novo)
`cd act && python3 scripts/chat_trace_mine_end2end_v62.py --acts_run results/run_pure_20k_v39_contracts_paraphrase_telemetry_smoke --out results/run_chat_trace_mine_end2end_v62_tryN --seed 0 --max_new_tokens 80 --chat_dialogues 4 --goal_shadow_max_goals_per_turn 1 --top_k_candidates 4 --max_total_overhead_bits 4096 --concept_overhead_bits 1024 --patch_diff patches/v62_chat_trace_mining_goalshadow_schema_try2.diff --freeze_path LEDGER_ATOLANG_V0_2_22_BASELINE_V62_CHAT_TRACE_MINING_GOALSHADOW_SCHEMA_TRYN.json`

### 4) Verificar freeze (recalcula sha256 + invariantes)
`cd act && python3 scripts/verify_freeze.py --freeze LEDGER_ATOLANG_V0_2_22_BASELINE_V62_CHAT_TRACE_MINING_GOALSHADOW_SCHEMA_TRY2.json | tee results/verify_freeze_v62_try2.json`

## Observação de compatibilidade
- `run_chat_suite` continua compatível com chamadas antigas: parâmetros novos têm default `None`.
- Schema do `goal_shadow.jsonl` mudou (agora 1 linha por goal); scripts antigos que buscavam o registro agregado “skip” foram ajustados para checar `skipped_by_scheduler=true`.

